<!DOCTYPE html>
<html lang="fa">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>{{SITE_NAME_FA}} {% block title%}{% endblock title%}</title>
	<meta name="description" content="{%block description%}{{SITE_DESC}}{%endblock%}" />
	
	{% block opengraph %} {% endblock %}
	{% include "pin2/all_header.html" %}

	<script type="text/javascript">
		var media_url = "{{MEDIA_URL}}";
		var upload_url = "{% url "pin-upload" %}";
	</script>


	{% include "base/analytics.html"%}
</head>
<body>

	{% include "pin2/nav.html" %}
	{% include "pin2/cats.html" %}

	{% block content %}{% endblock content%}

	{% if next_url %}
	<div class="footer-loading-box">
		<center>
			{% comment %}
			{% include "base/ad-125x125.html" %}
			{% endcomment %}
			<a id="next_url" href="{{next_url}}" title="کلیک کنید">
				<img src="{{MEDIA_URL}}v2/images/big-loader.gif" alt="Loading..." class="footer-loading-img" />
			</a>
		</center>
	</div>
	{% else %}
	<div class="footer-loading-box">
		<center>
			{% comment %}
			{% include "base/ad-125x125.html" %}
			{% endcomment %}
			<img src="{{MEDIA_URL}}v2/images/big-loader.gif" alt="Loading..." class="footer-loading-img" />
		</center>
	</div>
	{% endif %}

	{% include "pin2/footer.html" %}

	{% block footer_script %}{% endblock %}
	
	{% block footer_ex_js %}
	{% endblock footer_ex_js %}
	
	{% block js %}
	<script>
		$(document).ready(function() {
			// Load Infinit Scroll Notification 
	        var feedobj = $('#feed-ul');
	        var loadingobj ;
	        var a_url = a_url || "";
	        var start_loading = 0;
	            
	        $(window).scroll(function() {
	            loadingobj = $(".loading");
	            var break_point = $(document).height() - ($(window).height() * 2.02);
	            if ($(window).scrollTop() >= break_point) {
	                var next_page = $('#feed-ul span:last').attr('data-next');
	                if (next_page && start_loading==0) {
	                    start_loading=1;
	                    loadingobj.show();
	                    load_notif(next_page);
	                }
	            }
	        });
		    function load_notif(page) {
		        $.get(
		            a_url+'?pid=' + page,
		            function(response) {
		                if(response==0){
		                    loadingobj.hide();
		                }else{
		                    var boxes = response;
		                    feedobj.append(boxes);
		                    loadingobj.hide();
		                    start_loading=0;
		                    ana_ajax(a_url+'?pid=' + page);
		                }
		            }
		        );
		    }
		    // Add Comment
		    var frm = $("#add-comment-form");
			frm.submit(function(e) {

			    e.preventDefault();
			    $.ajax({
			    	type: frm.attr('method'),
			        url: frm.attr('action'),
			        data: frm.serialize(),
			    })
			    .done(function(response) {
			    	if (response == 'error'){
			    		console.log('Method Not Allowed');
			    	}else{
			    		$('#comments_box').append(response);
			    	}
			    })
			    .fail(function() {
			    	console.log("error");
			    })
			    .always(function() {
			    	console.log("complete");
			    });
			    return false;
			});	
	    });

	</script>
	{% endblock js %}

</body>
</html>